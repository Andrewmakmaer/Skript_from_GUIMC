# Автоматическая отправка шаблонных сообщений

Данный скрипт служит для того чтобы в автоматическом режиме отправлять шаблонные сообщения, опираясь на данные в таблице. Сообщения отправляются на электронный почтовый адрес.

Для того чтобы вы могли использовать этот скрипт, его, возможно, нужно будет несколько изменить, чтобы он подходил именно под вашу таблицу. Большая часть информации дана в виде комментариев в самом коде, но здесь будет обращено внимание на те моменты, которые позволят вам пользоваться скриптом, даже если вы вообще не ориентируетесь в javascript и никогда не программировали самостоятельно.


Подробно разберём этот участок кода
```javascript
for (i = 2; i <= numlaststr; ++i) {
    if (!list.getRange(i, 4).isBlank() && !list.getRange(i, 3).isBlank()) { 
      continue  
    } else if (list.getRange(i, 1).isBlank()){
      numlaststr = numlaststr - VoidRemoval(list, numlaststr, i);
    } else {
      var person_name = list.getRange(i, 2).getValue();
      var person_email = list.getRange(i, 3).getValue();
      SendMessage(person_name, person_email);
      list.getRange(i, 4).setValue('+');
    }
  } 
}
```

Переменная *i* в данном случае у нас будет означать строки. Вам не нужно обращать на это особое внимание, просто знайте, что мы начинаем считать со второй строки так как у нас считается, что первая строка — это заглавие таблицы.

column 1 | name | email | status
:---: | :---: | :---: | :---:
some data 1 | some name | some email | +, some text or empty

```javascript
if (!list.getRange(i, 4).isBlank() && !list.getRange(i, 3).isBlank()) { 
```

В данном и всех последующих случаях числа **4** и **3** означают столбец с **примечанием** и столбец с **почтовым адресом** соответственно. Из этого следует, что если ваша таблица спроектированна так, что у вас данные с почтовым адресом находятся, например в **5-м** столбце, а столбец с примечанием находится в **6-м** столбце, то нужно изменить соответствующие числа.

```javascript
if (!list.getRange(i, 6).isBlank() && !list.getRange(i, 5).isBlank()) { 
```

Ниже будут приведены пояснения для всех чисел в исходном коде:
- 1 — Первый столбец, в котором может располагаться любая информация (дата, индекс и т.д.). **Важно:** если этот столбец оказывается пустым, то вся строка в итоге будет считаться пустой и в последствии будет стёрта.
</br></br>

column 1 | name | email | status
:---: | :---: | :---: | :---:
some data 1 | some name1 | some email1 | '+', some text or empty
|  | some name2 | some email2 | '+', some text or empty
some data 3 | some name3 | some email3 | '+', some text or empty
</br>

В результате получится -->
</br></br>

column 1 | name | email | status
:---: | :---: | :---: | :---:
some data 1 | some name1 | some email1 | '+', some text or empty
some data 3 | some name3 | some email3 | '+', some text or empty
</br>

- 2 — Второй столбец, в исходном случае тут должно располагаться имя которое мы подставим в шаблон сообщения. (Об этом дальше)

- 3 — Третий столбец, в исходном случае тут должен располагаться столбец с данными о электронной почте.

- 4 — Четвёртый столбец, здесь располагается различная информация, в базовом случае здесь скрипт вписывает '+', если отправил сообщение на соответствующий этой строке почтовый адрес. Скрипт не будет игнорировать строку, только если ячейка в этом столбце пустая (исключая случай, когда пуста ячейка в превом столбце), так что можно использовать данный столбец для оставления служебной информации.

Не волнуйтесь, если в вашей таблице образуются пустые строки, скрипт сам приведёт таблицу к валидному виду для отправки сообщений.

Данный участок кода отвечает за формирование сообщения:

```javascript
var shublon = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("shublon").getRange(1, 1).getValue(); //берём шаблон сообщения
var message_text = shublon.replace('{name}', name);   //заменяем в шаблоне "{name}" на то что храниться в переменной name
```
Вы должны создать рядом с вашей основной таблицей таблицу с названием *shublon* или любым другим, но тогда не забудьте поменять код соответствующим образом (переменную ```var shublon = ...``` менять не обязательно). После этого скрипт возьмёт ваше шаблонное сообщение и, заменив *{name}* на значение в переменной *name*, отправит его адресату.

Пример шаблонного сообщения:
>Привет, {name}. Это шаблонное сообщение!

Вы можете использовать больше переменных для того чтобы формировать сообщение, расширив свой скрипт. Это вы можете сделать по инструкциям выше.

Документацию по Google Apps Script вы можете найти [здесь](https://developers.google.com/apps-script/overview)